<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Houkai Gakuen 2 Архив Сюжета</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Custom Dark Theme -->
    <!-- Application Structure Plan: SPA с фиксированным заголовком, содержащим название и переключатель языка. Основная область содержит три зависимых выпадающих списка (Тип сюжета -> Сюжет -> Этап) для навигации. Ниже расположена область динамического контента, которая отображает выбранный этап в формате визуальной новеллы (фон, спрайт персонажа, диалоговое окно). Эта структура выбрана для интуитивно понятной фильтрации и погружения в контент. -->
    <!-- Visualization & Content Choices: Информация: Архив сюжетов игры. Цель: Навигация и чтение. Метод представления: HTML-селекторы для фильтрации и динамически обновляемый div для отображения текста. Взаимодействие: Выбор опций в выпадающих списках последовательно загружает данные для следующих списков и, в конечном итоге, отображает выбранный сюжетный этап. Обоснование: Данный подход является стандартом для иерархической фильтрации контента и позволяет создать SPA без перезагрузки страницы. Библиотека: Vanilla JS для логики, Tailwind CSS для стилей. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background-color: #5c5c5c;
            color: #f0f0f0;
            font-family: 'Inter', sans-serif;
        }
        .header {
            background-color: #2a2a2a;
        }
        .custom-select {
            background-color: #3a3a3a;
            border-color: #7a7a7a;
            color: #f0f0f0;
        }
        .story-container {
            background-size: cover;
            background-position: center;
            min-height: 60vh;
        }
        .dialogue-box {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        .character-sprite {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            max-height: 85vh;
        }
        .sprite-left {
            transform: scaleX(-1);
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="header shadow-lg p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 id="main-title" class="text-xl md:text-2xl font-bold text-white">Houkai Gakuen 2 архив сюжета</h1>
        <div class="relative">
            <select id="language-selector" class="custom-select rounded-md py-2 px-3 appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-pink-500">
                <option value="ru">Русский</option>
                <option value="en">English</option>
                <option value="cn">中文</option>
            </select>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="bg-gray-800 bg-opacity-50 p-6 rounded-lg shadow-xl mb-8">
            <p id="intro-text" class="text-center mb-6 text-lg">Добро пожаловать в архив сюжета Houkai Gakuen 2. Выберите тип сюжета, главу и этап, чтобы начать чтение.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label id="label-story-type" for="story-type-selector" class="block mb-2 text-sm font-medium">Тип сюжета</label>
                    <select id="story-type-selector" class="custom-select w-full rounded-md p-2.5 focus:outline-none focus:ring-2 focus:ring-pink-500"></select>
                </div>
                <div>
                    <label id="label-story" for="story-selector" class="block mb-2 text-sm font-medium">Сюжет</label>
                    <select id="story-selector" class="custom-select w-full rounded-md p-2.5 focus:outline-none focus:ring-2 focus:ring-pink-500" disabled></select>
                </div>
                <div>
                    <label id="label-stage" for="stage-selector" class="block mb-2 text-sm font-medium">Этап</label>
                    <select id="stage-selector" class="custom-select w-full rounded-md p-2.5 focus:outline-none focus:ring-2 focus:ring-pink-500" disabled></select>
                </div>
            </div>
        </div>

        <div id="story-display" class="hidden">
             <div class="story-container w-full rounded-lg shadow-2xl flex flex-col justify-end items-center p-4 relative overflow-hidden">
                <div id="character-display" class="absolute inset-0 flex justify-center items-end">
                     <img id="sprite-left" src="" alt="Character Sprite Left" class="character-sprite sprite-left opacity-0 h-full object-contain object-bottom" style="max-width: 40%;">
                     <img id="sprite-right" src="" alt="Character Sprite Right" class="character-sprite h-full object-contain object-bottom opacity-0" style="max-width: 40%;">
                </div>
                <div id="dialogue-container" class="dialogue-box w-full max-w-4xl p-6 rounded-lg relative z-10 text-center hidden">
                    <h3 id="speaker-name" class="text-2xl font-bold text-pink-400 mb-2"></h3>
                    <p id="dialogue-text" class="text-lg leading-relaxed"></p>
                    <div class="flex justify-center mt-4 gap-4">
                        <button id="prev-btn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300"></button>
                        <button id="next-btn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300"></button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const i18n = {
            ru: {
                mainTitle: "Houkai Gakuen 2 архив сюжета",
                introText: "Добро пожаловать в архив сюжета Houkai Gakuen 2. Выберите тип сюжета, главу и этап, чтобы начать чтение.",
                labels: {
                    storyType: "Тип сюжета",
                    story: "Сюжет",
                    stage: "Этап",
                },
                buttons: {
                    prev: "Назад",
                    next: "Далее",
                },
                placeholders: {
                    select: "Выберите...",
                    story: "Сначала выберите тип",
                    stage: "Сначала выберите сюжет"
                },
                storyTypes: {
                    main: "Основной сюжет",
                    extra: "Дополнительный сюжет",
                    boss: "Боссы",
                    vn: "Визуальная новелла",
                    novel: "Роман"
                },
            },
            en: {
                mainTitle: "Houkai Gakuen 2 Story Archive",
                introText: "Welcome to the Houkai Gakuen 2 Story Archive. Select a story type, chapter, and stage to start reading.",
                labels: {
                    storyType: "Story Type",
                    story: "Story",
                    stage: "Stage",
                },
                buttons: {
                    prev: "Previous",
                    next: "Next",
                },
                placeholders: {
                    select: "Select...",
                    story: "Select a type first",
                    stage: "Select a story first"
                },
                storyTypes: {
                    main: "Main Story",
                    extra: "Extra Story",
                    boss: "Bosses",
                    vn: "Visual Novel",
                    novel: "Novel"
                },
            },
            cn: {
                mainTitle: "崩坏学园2剧情档案",
                introText: "欢迎来到崩坏学园2剧情档案。请选择故事类型、章节和关卡开始阅读。",
                labels: {
                    storyType: "故事类型",
                    story: "剧情",
                    stage: "关卡",
                },
                buttons: {
                    prev: "上一页",
                    next: "下一页",
                },
                placeholders: {
                    select: "请选择...",
                    story: "请先选择类型",
                    stage: "请先选择剧情"
                },
                storyTypes: {
                    main: "主线剧情",
                    extra: "支线剧情",
                    boss: "首领",
                    vn: "视觉小说",
                    novel: "小说"
                },
            }
        };

        const storyData = {
            main: {
                "ch1": { 
                    ru: "Глава 1: Выброс Хоукая", 
                    en: "Chapter 1: Houkai Outbreak", 
                    cn: "第1章：崩坏爆发",
                    stages: {
                        "s1": { ru: "1-1", en: "1-1", cn: "1-1" },
                        "s2": { ru: "1-2", en: "1-2", cn: "1-2" },
                        "s3": { ru: "1-3", en: "1-3", cn: "1-3" },
                    }
                },
                "ch2": { 
                    ru: "Глава 2: Киана наносит ответный удар", 
                    en: "Chapter 2: Kiana Strikes Back", 
                    cn: "第2章：琪亚娜反击",
                    stages: {
                        "s1": { ru: "2-1", en: "2-1", cn: "2-1" },
                        "s2": { ru: "2-2", en: "2-2", cn: "2-2" },
                    }
                },
                 "ch3": { 
                    ru: "Глава 3: Зловещая молния", 
                    en: "Chapter 3: Sinister Lightning", 
                    cn: "第3章：不祥的闪电",
                    stages: {
                        "s1": { ru: "3-1", en: "3-1", cn: "3-1" },
                    }
                },
            },
            extra: {
                "ex1": { 
                    ru: "Экстра 1: Берегись", 
                    en: "Extra 1: Beware", 
                    cn: "额外1：当心",
                    stages: {
                        "s1": { ru: "Э1-1", en: "E1-1", cn: "附1-1" },
                    }
                },
                "ex2": { 
                    ru: "Экстра 2: Неутолимое желание", 
                    en: "Extra 2: Insatiable Desire", 
                    cn: "额外2：永不满足的欲望",
                     stages: {
                        "s1": { ru: "Э2-1", en: "E2-1", cn: "附2-1" },
                        "s2": { ru: "Э2-2", en: "E2-2", cn: "附2-2" },
                    }
                }
            },
            boss: {},
            vn: {},
            novel: {}
        };
        
        const stageContent = {
            "main_ch1_s1": {
                background: "https://placehold.co/1920x1080/2E3440/ECEFF4?text=images/background/school.png",
                dialogue: [
                    { speaker: {ru: "Киана", en: "Kiana", cn: "琪亚娜"}, sprite: "kiana_normal.png", position: "right", text: {ru: "Что происходит? Голова... раскалывается.", en: "What's happening? My head... it's splitting.", cn: "发生什么了？我的头...好痛。"}},
                    { speaker: {ru: "???", en: "???", cn: "???"}, sprite: "", position: "", text: {ru: "Вокруг только тишина... и запах крови.", en: "There's only silence... and the smell of blood.", cn: "周围只有寂静...和血腥味。"}},
                    { speaker: {ru: "Киана", en: "Kiana", cn: "琪亚娜"}, sprite: "kiana_alert.png", position: "right", text: {ru: "Нужно найти выход. И быстро.", en: "I have to find a way out. And fast.", cn: "我必须找到出路。快点。"}},
                ]
            },
            "main_ch1_s2": {
                background: "https://placehold.co/1920x1080/4C566A/ECEFF4?text=images/background/corridor.png",
                dialogue: [
                    { speaker: {ru: "Мэй", en: "Mei", cn: "芽衣"}, sprite: "mei_sad.png", position: "left", text: {ru: "Киана-чан... Ты в порядке?", en: "Kiana-chan... Are you alright?", cn: "琪亚娜酱...你还好吗？"}},
                    { speaker: {ru: "Киана", en: "Kiana", cn: "琪亚娜"}, sprite: "kiana_normal.png", position: "right", text: {ru: "Мэй-семпай! Я так рада тебя видеть!", en: "Mei-senpai! I'm so glad to see you!", cn: "芽衣学姐！很高兴见到你！"}},
                ]
            },
            "extra_ex1_s1": {
                 background: "https://placehold.co/1920x1080/5E81AC/ECEFF4?text=images/background/city.png",
                dialogue: [
                     { speaker: {ru: "Броня", en: "Bronya", cn: "布洛妮娅"}, sprite: "bronya_normal.png", position: "left", text: {ru: "Объект обнаружен. Броня начинает операцию.", en: "Target acquired. The Bronya is commencing the operation.", cn: "发现目标。布洛妮娅开始行动。"}},
                ]
            }
        };

        let currentLang = 'ru';
        let currentDialogueIndex = 0;
        let currentStageData = null;

        const langSelector = document.getElementById('language-selector');
        const mainTitle = document.getElementById('main-title');
        const introText = document.getElementById('intro-text');
        const labelStoryType = document.getElementById('label-story-type');
        const labelStory = document.getElementById('label-story');
        const labelStage = document.getElementById('label-stage');
        const storyTypeSelector = document.getElementById('story-type-selector');
        const storySelector = document.getElementById('story-selector');
        const stageSelector = document.getElementById('stage-selector');
        const storyDisplay = document.getElementById('story-display');
        const storyContainer = storyDisplay.querySelector('.story-container');
        const dialogueContainer = document.getElementById('dialogue-container');
        const speakerName = document.getElementById('speaker-name');
        const dialogueText = document.getElementById('dialogue-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const spriteLeft = document.getElementById('sprite-left');
        const spriteRight = document.getElementById('sprite-right');

        function updateUI() {
            const t = i18n[currentLang];
            mainTitle.textContent = t.mainTitle;
            introText.textContent = t.introText;
            labelStoryType.textContent = t.labels.storyType;
            labelStory.textContent = t.labels.story;
            labelStage.textContent = t.labels.storyStage;
            prevBtn.textContent = t.buttons.prev;
            nextBtn.textContent = t.buttons.next;

            populateStoryTypes();
            populateStories();
            populateStages();
            
            if(currentStageData) {
                renderDialogue();
            }
        }

        function populateStoryTypes() {
            const t = i18n[currentLang];
            const selectedValue = storyTypeSelector.value;
            storyTypeSelector.innerHTML = `<option value="">${t.placeholders.select}</option>`;
            for (const typeKey in t.storyTypes) {
                const option = document.createElement('option');
                option.value = typeKey;
                option.textContent = t.storyTypes[typeKey];
                storyTypeSelector.appendChild(option);
            }
            storyTypeSelector.value = selectedValue;
        }

        function populateStories() {
            const t = i18n[currentLang];
            const storyType = storyTypeSelector.value;
            const selectedValue = storySelector.value;
            storySelector.innerHTML = '';

            if (!storyType) {
                storySelector.innerHTML = `<option value="">${t.placeholders.story}</option>`;
                storySelector.disabled = true;
                return;
            }
            
            storySelector.disabled = false;
            storySelector.innerHTML = `<option value="">${t.placeholders.select}</option>`;
            const stories = storyData[storyType];
            for (const storyKey in stories) {
                const option = document.createElement('option');
                option.value = storyKey;
                option.textContent = stories[storyKey][currentLang];
                storySelector.appendChild(option);
            }
            storySelector.value = selectedValue;
        }
        
        function populateStages() {
            const t = i18n[currentLang];
            const storyType = storyTypeSelector.value;
            const story = storySelector.value;
            const selectedValue = stageSelector.value;
            stageSelector.innerHTML = '';

            if (!storyType || !story) {
                stageSelector.innerHTML = `<option value="">${t.placeholders.stage}</option>`;
                stageSelector.disabled = true;
                return;
            }

            stageSelector.disabled = false;
            stageSelector.innerHTML = `<option value="">${t.placeholders.select}</option>`;
            const stages = storyData[storyType][story].stages;
            for (const stageKey in stages) {
                const option = document.createElement('option');
                option.value = stageKey;
                option.textContent = stages[stageKey][currentLang];
                stageSelector.appendChild(option);
            }
            stageSelector.value = selectedValue;
        }

        function displayStage() {
            const storyType = storyTypeSelector.value;
            const story = storySelector.value;
            const stage = stageSelector.value;

            if (storyType && story && stage) {
                const contentKey = `${storyType}_${story}_${stage}`;
                currentStageData = stageContent[contentKey];
                
                if (currentStageData) {
                    storyDisplay.classList.remove('hidden');
                    storyContainer.style.backgroundImage = `url('${currentStageData.background}')`;
                    currentDialogueIndex = 0;
                    renderDialogue();
                    dialogueContainer.classList.remove('hidden');
                } else {
                    storyDisplay.classList.add('hidden');
                    dialogueContainer.classList.add('hidden');
                }
            } else {
                storyDisplay.classList.add('hidden');
                dialogueContainer.classList.add('hidden');
            }
        }

        function renderDialogue() {
            if (!currentStageData || !currentStageData.dialogue) return;

            const dialogue = currentStageData.dialogue[currentDialogueIndex];
            
            speakerName.textContent = dialogue.speaker[currentLang] || '';
            dialogueText.textContent = dialogue.text[currentLang] || '';
            
            spriteLeft.style.opacity = 0;
            spriteRight.style.opacity = 0;

            if (dialogue.sprite) {
                const spriteUrl = `https://placehold.co/800x1200/000000/FFFFFF?text=images/sprites/${dialogue.sprite}`;
                if (dialogue.position === 'left') {
                    spriteLeft.src = spriteUrl;
                    spriteLeft.style.opacity = 1;
                } else if (dialogue.position === 'right') {
                    spriteRight.src = spriteUrl;
                    spriteRight.style.opacity = 1;
                }
            }

            prevBtn.disabled = currentDialogueIndex === 0;
            nextBtn.disabled = currentDialogueIndex === currentStageData.dialogue.length - 1;
        }

        langSelector.addEventListener('change', (e) => {
            currentLang = e.target.value;
            updateUI();
        });

        storyTypeSelector.addEventListener('change', () => {
            storySelector.value = '';
            stageSelector.value = '';
            populateStories();
            populateStages();
            displayStage();
        });
        
        storySelector.addEventListener('change', () => {
            stageSelector.value = '';
            populateStages();
            displayStage();
        });

        stageSelector.addEventListener('change', displayStage);

        prevBtn.addEventListener('click', () => {
            if (currentDialogueIndex > 0) {
                currentDialogueIndex--;
                renderDialogue();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentStageData && currentDialogueIndex < currentStageData.dialogue.length - 1) {
                currentDialogueIndex++;
                renderDialogue();
            }
        });
        
        updateUI();
    </script>
</body>
</html>
